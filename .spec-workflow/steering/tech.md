# Scrap-Board Steering Document

## 概要
Scrap-BoardはウェブコンテンツとPDFの収集・処理・管理を行う日本語対応のウェブアプリケーションです。本書はプロダクトの技術方針、アーキテクチャ上の重要決定、コード構成指針をまとめたsteering documentです。目的はコア設計の合意を早期に取り、実装の一貫性と保守性を確保することです。

## ゴール
- 日本語記事の取り込みと高品質な要約、分類、検索を提供すること
- ローカル/オンプレでLLMを使える構成（LM Studio / Ollama）をサポート
- 小規模な単一コンテナで実行可能な構成を維持
- 開発者に優しい高速な開発ループ（ホットリロード、軽量テスト）を提供

## 技術スタック（決定）
- バックエンド: Python 3.11+、FastAPI
- フロントエンド: HTMX + Jinja2、Tailwind CSS
- DB: SQLite（初期・開発）
- LLM統合: LM Studio（デフォルト）、Ollama（代替）
- PDF処理: Docling（主）、pdfminer.six（フォールバック）
- HTML抽出: Trafilatura
- コンテナ: Docker（単一コンテナ設計）

## アーキテクチャ方針
- シンプルなモノリシック構造を採用。マイクロサービス化は必要になったら検討。
- LLMアクセスは抽象化レイヤを作り、バックエンドから呼べる共通APIとして提供する。
- コンテンツ処理パイプラインを明確に分離（受け入れ → 抽出 → 正規化 → 埋め込み → 分類 → 保存）。
- 全てのユーザー向けテキストは日本語で提供。

## コード構成ガイドライン
- ディレクトリ: `app/` 配下に `core/`, `services/`, `api/routes/`, `templates/`, `static/` を維持
- 設定: `app/core/config.py` を唯一の環境設定読み取り箇所にする
- DBアクセス: SQLAlchemy（または軽量ラッパ）で抽象化。マイグレーションは Alembic（導入時）
- LLM クライアント: `app/services/llm_client.py` に抽象インタフェースを実装
- テスト: `tests/` でユニット＋エンドツーエンド（playwright）を維持

## 運用方針
- robots.txtの尊重、ターゲットサイトへのレート制限をデフォルト有効
- LLMサービスが使えない場合のフォールバック（例: 埋め込み生成の遅延リトライ、要約機能を一時的に非表示）
- ログは操作を追える程度のINFO、詳細は DEBUG

## セキュリティ
- 環境変数でLLMのエンドポイントを管理。シークレットは.envやシークレット管理ツールで管理
- 外部へ送られるコンテンツは最小限に留め、ユーザーデータの送信前に明示的な同意を要求するUIの検討

## 開発導線
- 新しい機能はまず `tasks.md` にチケット化し、実装はPSRに沿ったPRで行う
- CI: pytestベースのテストと静的解析（flake8, mypy）を導入する

## 将来の拡張候補
- SQLite → PostgreSQLへの切替を容易にする抽象化
- 外部検索エンジン（Elasticsearch / Meilisearch）統合
- マルチユーザー権限と共有コレクション

## 付録: 初期設定サンプル
- `.env`、LM Studio/Ollamaの接続サンプル、コンテナ起動手順を `README.md` に載せる


