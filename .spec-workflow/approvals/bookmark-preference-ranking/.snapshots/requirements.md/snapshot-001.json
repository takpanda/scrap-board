{
  "id": "snapshot_1759059605763_nl61babsf",
  "approvalId": "approval_1759059605730_lne28rq5b",
  "approvalTitle": "bookmark-preference-ranking requirements",
  "version": 1,
  "timestamp": "2025-09-28T11:40:05.763Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements Document\n\n## Introduction\n\nDesign and implement a personalization capability that derives user reading preferences from bookmarked articles and leverages the resulting profile to rank newly ingested documents by predicted relevance. The feature reduces the time users spend sifting through large daily intakes and elevates content that matches their interests.\n\n## Alignment with Product Vision\n\nThis feature directly supports the product goal of delivering a faster, more focused reading workflow for Japanese content collectors. By surfacing high-likelihood matches first, the experience becomes more efficient, keeps the app lightweight, and makes the LLM-assisted summarization pipeline more impactful for the individuals described in product.md.\n\n## Requirements\n\n### Requirement 1\n\n**User Story:** As a frequent Scrap-Board reader, I want the system to infer my topical preferences from my bookmarks so that new arrivals reflect what I care about most.\n\n#### Acceptance Criteria\n\n1. WHEN a document is bookmarked THEN the system SHALL update the user preference profile within five minutes.\n2. IF a user has fewer than three bookmarks THEN the system SHALL mark the preference profile as cold-start and prevent it from influencing rankings.\n3. WHEN the profile update job fails AND the retry budget is exhausted THEN the system SHALL emit a warning log and queue the document for manual inspection.\n\n### Requirement 2\n\n**User Story:** As a user browsing newly ingested articles, I want the list sorted by my inferred interests so that I can quickly read the most relevant content.\n\n#### Acceptance Criteria\n\n1. WHEN a user opens the documents page with the recommended sort selected THEN the system SHALL return results ordered by descending personalized relevance score.\n2. IF a personalized score is unavailable for a document THEN the system SHALL fall back to the default sort order without causing gaps in the list.\n3. WHEN the user switches the sort order manually THEN the system SHALL persist the chosen sort mode for the current session.\n\n### Requirement 3\n\n**User Story:** As a power user, I want transparency into why an article was recommended so that I can trust and adjust the system when needed.\n\n#### Acceptance Criteria\n\n1. WHEN a user inspects a ranked document THEN the system SHALL present key contributing factors (e.g., matching categories, domains, or similarity score) in Japanese.\n2. IF the relevance score is based on cold-start defaults THEN the system SHALL display a message explaining that personalization is not yet active.\n3. WHEN the user flags a recommendation as not relevant THEN the system SHALL record feedback for future preference recalibration.\n\n## Non-Functional Requirements\n\n### Code Architecture and Modularity\n- **Single Responsibility Principle**: Separate modules for profile calculation, score computation, and presentation logic.\n- **Modular Design**: Expose preference data via service interfaces consumable by both API routes and background jobs.\n- **Dependency Management**: Restrict database access to repository or service layers to avoid tight coupling with FastAPI routes.\n- **Clear Interfaces**: Define Pydantic models or dataclasses for preference profiles and scoring results.\n\n### Performance\n- Preference updates SHALL complete within five minutes of a bookmark event for the median case.\n- Ranking responses SHALL add no more than 150 ms to the existing `/documents` endpoint latency at P95.\n\n### Security\n- Personalized data SHALL remain within the local environment and MUST NOT be sent to external LLM endpoints.\n- Access to preference data SHALL respect future multi-user boundaries by scoping queries per user ID when introduced.\n\n### Reliability\n- Background jobs SHALL retry failed profile updates at least three times with exponential backoff.\n- Personalized ranking SHALL degrade gracefully to default ordering when the preference profile is unavailable.\n\n### Usability\n- UI text explaining recommendation rationale SHALL be written in natural Japanese.\n- The recommended sort option SHALL be discoverable within two clicks from the documents list view.\n",
  "fileStats": {
    "size": 4147,
    "lines": 66,
    "lastModified": "2025-09-28T11:39:41.858Z"
  },
  "comments": []
}