# Requirements Document

## Introduction

本要件書は、Scrap-Boardのドキュメント一覧ページにおけるモバイル表示時のスワイプナビゲーション機能を定義します。ユーザーがモバイルデバイスで記事を閲覧する際、左右のスワイプジェスチャーにより、隣接する記事へスムーズに移動できる機能を提供します。これにより、モバイルでの読書体験が向上し、連続的なコンテンツ閲覧が容易になります。

## Requirements

### Requirement 1: スワイプジェスチャー検出
**Objective:** As a モバイルユーザー, I want 画面を左右にスワイプ操作できる機能, so that 次の記事や前の記事に素早く移動できる

#### Acceptance Criteria
1. WHEN ユーザーがモバイル画面で右方向にスワイプ THEN スワイプナビゲーションシステム SHALL 次の記事への移動を開始する
2. WHEN ユーザーがモバイル画面で左方向にスワイプ THEN スワイプナビゲーションシステム SHALL 前の記事への移動を開始する
3. IF スワイプ距離が最小閾値（50px以上）に達している THEN スワイプナビゲーションシステム SHALL スワイプ操作として認識する
4. IF スワイプ距離が最小閾値未満である THEN スワイプナビゲーションシステム SHALL スワイプ操作を無視する
5. WHILE ユーザーがスワイプジェスチャーを実行中 THE スワイプナビゲーションシステム SHALL リアルタイムでスワイプ距離を追跡する

### Requirement 2: モバイル環境判定
**Objective:** As a システム管理者, I want スワイプ機能がモバイル環境でのみ有効化される, so that デスクトップ表示時の操作に干渉しない

#### Acceptance Criteria
1. WHEN ページが読み込まれた時 THEN スワイプナビゲーションシステム SHALL ビューポート幅を確認する
2. IF ビューポート幅が768px未満（モバイル閾値）である THEN スワイプナビゲーションシステム SHALL スワイプ機能を有効化する
3. IF ビューポート幅が768px以上（デスクトップ閾値）である THEN スワイプナビゲーションシステム SHALL スワイプ機能を無効化する
4. WHEN ウィンドウサイズが変更された時 THEN スワイプナビゲーションシステム SHALL モバイル環境判定を再実行する
5. WHERE デスクトップ表示環境 THE スワイプナビゲーションシステム SHALL スワイプイベントリスナーを登録しない

### Requirement 3: 記事リスト参照とナビゲーション
**Objective:** As a モバイルユーザー, I want スワイプ操作で現在表示中の記事に対応する次/前の記事に移動できる, so that リスト順に効率的に記事を閲覧できる

#### Acceptance Criteria
1. WHEN スワイプナビゲーションシステムが初期化される時 THEN スワイプナビゲーションシステム SHALL 現在のドキュメント一覧から記事IDリストを取得する
2. WHEN 記事詳細ページが表示されている時 THEN スワイプナビゲーションシステム SHALL 現在の記事IDをリスト内で特定する
3. IF 現在の記事がリスト内に存在し、次の記事が存在する THEN スワイプナビゲーションシステム SHALL 右スワイプで次の記事IDを決定する
4. IF 現在の記事がリスト内に存在し、前の記事が存在する THEN スワイプナビゲーションシステム SHALL 左スワイプで前の記事IDを決定する
5. IF 現在の記事がリストの最初であり、左スワイプが実行された THEN スワイプナビゲーションシステム SHALL ナビゲーションを実行しない
6. IF 現在の記事がリストの最後であり、右スワイプが実行された THEN スワイプナビゲーションシステム SHALL ナビゲーションを実行しない
7. WHEN 次/前の記事IDが決定された時 THEN スワイプナビゲーションシステム SHALL 該当記事の詳細ページにナビゲートする

### Requirement 4: UI/UXフィードバック
**Objective:** As a モバイルユーザー, I want スワイプ操作中に視覚的なフィードバックを得る, so that 操作が受け付けられたことを確認できる

#### Acceptance Criteria
1. WHEN ユーザーがスワイプを開始した時 THEN スワイプナビゲーションシステム SHALL スワイプ方向を示す視覚的インジケーターを表示する
2. WHILE ユーザーがスワイプジェスチャーを継続中 THE スワイプナビゲーションシステム SHALL スワイプ距離に応じてインジケーターのサイズや透明度を動的に変化させる
3. WHEN スワイプ距離が移動閾値（100px以上）に達した時 THEN スワイプナビゲーションシステム SHALL インジケーターの色や表示を変更して移動可能状態を示す
4. WHEN スワイプ操作が完了した（touchend）時 THEN スワイプナビゲーションシステム SHALL インジケーターを非表示にする
5. IF ナビゲーションが実行されない（リスト端到達）場合 THEN スワイプナビゲーションシステム SHALL 「これ以上移動できない」旨の視覚的フィードバックを表示する

### Requirement 5: HTMX統合とページ遷移
**Objective:** As a システム開発者, I want スワイプナビゲーションが既存のHTMX部分更新アーキテクチャと整合する, so that アプリケーション全体の一貫性を保つ

#### Acceptance Criteria
1. WHEN スワイプ操作で記事移動が決定された時 THEN スワイプナビゲーションシステム SHALL HTMXの`hx-get`属性相当の動作でコンテンツを取得する
2. WHEN 新しい記事コンテンツが取得された時 THEN スワイプナビゲーションシステム SHALL 記事詳細表示エリアを部分的に更新する
3. WHEN 記事遷移が完了した時 THEN スワイプナビゲーションシステム SHALL ブラウザ履歴に新しい記事URLをプッシュする（`hx-push-url`相当）
4. WHEN 記事遷移が完了した時 THEN スワイプナビゲーションシステム SHALL ページタイトルを新しい記事のタイトルに更新する
5. WHERE 記事詳細モーダルが表示されている場合 THE スワイプナビゲーションシステム SHALL モーダル内コンテンツのみを更新し、モーダル自体は開いたままにする

### Requirement 6: エラーハンドリングとフォールバック
**Objective:** As a モバイルユーザー, I want ネットワークエラーやデータ取得失敗時に適切なエラーメッセージを受け取る, so that 問題の原因を理解できる

#### Acceptance Criteria
1. WHEN 記事コンテンツ取得時にネットワークエラーが発生した THEN スワイプナビゲーションシステム SHALL エラートースト通知を表示する
2. WHEN 記事IDがリスト内に存在しない場合 THEN スワイプナビゲーションシステム SHALL スワイプナビゲーションを無効化し、警告ログを出力する
3. IF スワイプ操作中にJavaScriptエラーが発生した THEN スワイプナビゲーションシステム SHALL エラーをキャッチし、デフォルトのスクロール動作にフォールバックする
4. WHEN リスト取得APIが失敗した時 THEN スワイプナビゲーションシステム SHALL スワイプ機能を無効化し、通常のタップナビゲーションにフォールバックする
5. WHERE エラー状態が継続する場合 THE スワイプナビゲーションシステム SHALL 一定回数（3回）のリトライ後、完全に無効化する

### Requirement 7: パフォーマンスと応答性
**Objective:** As a モバイルユーザー, I want スワイプ操作が滑らかで遅延なく動作する, so that 快適な読書体験を得る

#### Acceptance Criteria
1. WHEN スワイプジェスチャーが検出された時 THEN スワイプナビゲーションシステム SHALL 50ms以内に視覚的フィードバックを開始する
2. WHEN 記事遷移が開始された時 THEN スワイプナビゲーションシステム SHALL 300ms以内にコンテンツ取得リクエストを発行する
3. WHILE コンテンツ取得中 THE スワイプナビゲーションシステム SHALL ローディングインジケーターを表示する
4. WHEN 新しい記事が読み込まれた時 THEN スワイプナビゲーションシステム SHALL 500ms以内にコンテンツを描画完了する
5. WHERE 複数回のスワイプが短時間に実行された場合 THE スワイプナビゲーションシステム SHALL デバウンス処理（200ms）を適用し、重複リクエストを防止する

### Requirement 8: アクセシビリティ考慮
**Objective:** As a 視覚障害のあるモバイルユーザー, I want スワイプナビゲーション機能がスクリーンリーダーと共存できる, so that アクセシビリティを損なわない

#### Acceptance Criteria
1. WHEN スワイプナビゲーションが有効化された時 THEN スワイプナビゲーションシステム SHALL ARIA属性を適切に設定する
2. WHERE スワイプインジケーターが表示される場合 THE スワイプナビゲーションシステム SHALL `role="status"`と`aria-live="polite"`を設定する
3. WHEN 記事遷移が完了した時 THEN スワイプナビゲーションシステム SHALL スクリーンリーダーに新しい記事タイトルを通知する
4. IF ユーザーがスクリーンリーダーを使用している THEN スワイプナビゲーションシステム SHALL 代替のタップナビゲーションボタンを提供する
5. WHERE キーボードナビゲーションが必要な場合 THE スワイプナビゲーションシステム SHALL 左右矢印キーでの記事移動もサポートする
