# 要件ドキュメント

## プロジェクト概要

記事詳細モーダルのレイアウトをモバイル表示でも崩れないようにレスポンシブ対応を実装する。具体的には以下の問題を解決する:

1. **モバイル表示時のレイアウト崩れ**: 768px以下の画面でモーダルのレイアウトが崩れる
2. **ラベルの改行問題**: カテゴリやタグのラベルが予期せず改行され、レイアウトが乱れる
3. **ヘッダの縦幅問題**: モバイル画面でヘッダが縦に長くなりすぎて、コンテンツ領域が圧迫される

現在の実装では、デスクトップ表示を前提としたスタイリングが適用されており、モバイル画面での閲覧体験が最適化されていない。この仕様では、デバイスサイズに応じた適切なレイアウトとスタイリングを実装し、すべてのデバイスで快適な閲覧体験を提供する。

## 要件

### 要件1: モバイル画面でのレイアウト安定化
**目的:** Scrap-Boardの利用者として、記事詳細モーダルをモバイル画面（768px以下）で開いたときに、レイアウトが崩れずコンテンツが読みやすく表示されることを期待する。

#### 受け入れ基準
1. WHEN ビューポート幅が768px以下でユーザーが記事詳細モーダルを開く THEN 記事詳細モーダル SHALL 横方向のはみ出し（horizontal overflow）を発生させず、画面幅に収まるレイアウトを維持する
2. WHEN モバイル画面でモーダルが表示される THEN 記事詳細モーダル SHALL ヘッダ、コンテンツ、フッターの各セクションが視覚的に区別され、適切な余白を持って配置される
3. WHERE モバイル画面でサムネイルや画像が存在する場合 THE 記事詳細モーダル SHALL 画像のアスペクト比を維持したまま画面幅に応じて縮小し、コンテンツ領域を圧迫しない
4. WHEN モバイル画面でモーダルのコンテンツが画面高さを超える THEN 記事詳細モーダル SHALL モーダル内部にスクロールを提供し、背景のスクロールは無効化する

### 要件2: ラベル表示の改行防止とオーバーフロー処理
**目的:** Scrap-Boardの利用者として、カテゴリやタグなどのラベルが意図しない改行で表示が乱れることなく、読みやすい形で表示されることを期待する。

#### 受け入れ基準
1. WHEN モーダル内にカテゴリラベルまたはタグラベルが表示される THEN 記事詳細モーダル SHALL 各ラベルに対して `white-space: nowrap` を適用し、ラベルテキストが複数行に折り返されないようにする
2. IF ラベルのテキスト長が親コンテナの幅を超える場合 THEN 記事詳細モーダル SHALL テキストを省略記号（ellipsis）で切り詰め、`text-overflow: ellipsis` と `overflow: hidden` を適用する
3. WHEN ユーザーが切り詰められたラベルにマウスホバーまたはロングタップする THEN 記事詳細モーダル SHALL 完全なラベルテキストをツールチップまたは `title` 属性で表示する
4. WHERE 複数のラベルが横並びで表示される場合 THE 記事詳細モーダル SHALL ラベルコンテナに `flex-wrap: wrap` を適用し、必要に応じて次の行に折り返すが、個々のラベル内では改行しない

### 要件3: モバイル画面でのヘッダ高さ最適化
**目的:** Scrap-Boardの利用者として、モバイル画面でモーダルを開いたときに、ヘッダが必要最小限の高さに収まり、コンテンツ閲覧領域が最大化されることを期待する。

#### 受け入れ基準
1. WHEN ビューポート幅が768px以下でモーダルヘッダが表示される THEN 記事詳細モーダル SHALL ヘッダの垂直パディングを `p-4`（1rem）以下に削減し、デスクトップの `p-6`（1.5rem）から縮小する
2. WHEN モバイル画面でモーダルヘッダが表示される THEN 記事詳細モーダル SHALL ヘッダ内のタイトルフォントサイズを `text-lg`（1.125rem）以下に調整し、デスクトップの `text-xl`（1.25rem）から縮小する
3. IF ヘッダに複数の情報要素（タイトル、メタデータ、閉じるボタン）が含まれる場合 THEN 記事詳細モーダル SHALL 要素間のマージンを最小化し、縦積みレイアウトを採用してヘッダの総高さを56px以内に抑える
4. WHERE ヘッダに二次的なメタデータ（公開日、ソース名など）が含まれる場合 THE 記事詳細モーダル SHALL モバイル画面では該当情報を1行に要約するか、必要に応じて折りたたみ可能にする

### 要件4: タッチ操作とアクセシビリティの確保
**目的:** Scrap-Boardの利用者として、モバイルデバイスでのタッチ操作が快適で、アクセシビリティ基準を満たしたモーダル操作を体験したい。

#### 受け入れ基準
1. WHEN モバイル画面でモーダル内のボタンやリンクが表示される THEN 記事詳細モーダル SHALL すべてのタップ可能要素に最低44x44 CSSピクセルのタッチターゲットサイズを確保する
2. WHEN ユーザーがモーダル内のスクロール可能領域をスワイプする THEN 記事詳細モーダル SHALL `-webkit-overflow-scrolling: touch` を適用し、慣性スクロール（momentum scrolling）を有効化する
3. IF ラベルテキストが視覚的に切り詰められている場合 THEN 記事詳細モーダル SHALL スクリーンリーダー向けに完全なテキストを `aria-label` または `title` 属性で提供する
4. WHEN キーボードフォーカスがモーダル内の要素に移動する THEN 記事詳細モーダル SHALL フォーカス状態を視覚的に示すアウトラインまたはボーダーを表示し、キーボード操作のみでモーダル内のすべての操作可能要素にアクセスできる

### 要件5: 非侵襲的なスタイリングとコンポーネント独立性
**目的:** 開発者として、モーダルのレスポンシブスタイル変更が既存の他のコンポーネントやページレイアウトに影響を与えないことを保証したい。

#### 受け入れ基準
1. WHEN レスポンシブ対応のCSSを追加する場合 THEN スタイル変更 SHALL モーダル専用のクラスセレクタ（例: `.modal-content`, `[data-modal-dialog]`, `[data-modal-scrollable]`）に限定され、グローバルな要素セレクタ（`div`, `p`, `button`など）を使用しない
2. IF Tailwindユーティリティクラスでレスポンシブルールを定義する場合 THEN スタイル SHALL `@media (max-width: 768px)` ブレークポイントを使用し、`md:` プレフィックスまたはカスタムメディアクエリで実装する
3. WHEN `style.css` にカスタムCSSを追加する場合 THEN 新規スタイル SHALL 既存のグローバルボタンスタイルやカードスタイルを上書きせず、モーダル専用のスコープ内でのみ適用される
4. WHERE `!important` 宣言が必要な場合 THE スタイル SHALL その使用理由をコメントで明記し、影響範囲を最小限に限定する

### 要件6: デスクトップ表示との互換性維持
**目的:** Scrap-Boardの利用者として、デスクトップ画面（768px以上）でのモーダル表示が現状の品質を維持し、レスポンシブ対応によって劣化しないことを期待する。

#### 受け入れ基準
1. WHEN ビューポート幅が768px以上でモーダルが表示される THEN 記事詳細モーダル SHALL 既存のデスクトップレイアウト（最大幅800px、中央配置、余白など）を維持する
2. WHEN デスクトップ画面でモーダルヘッダが表示される THEN 記事詳細モーダル SHALL 現在のパディング（`p-6`）、フォントサイズ、要素間隔を変更せず表示する
3. IF モバイル向けに追加したスタイルが存在する場合 THEN スタイル SHALL メディアクエリで適切にスコープされ、デスクトップ画面では適用されない
4. WHEN 既存のE2EテストやUIテストを実行する THEN テストスイート SHALL デスクトップ画面での動作に関してすべてのテストがパスする

### 要件7: パフォーマンスとレンダリング品質
**目的:** Scrap-Boardの利用者として、モバイル画面でモーダルを開いた際に、レンダリングが高速で滑らかなアニメーションを体験したい。

#### 受け入れ基準
1. WHEN モバイル画面でモーダルを開く THEN 記事詳細モーダル SHALL 初回レンダリングを300ms以内に完了し、ユーザーに遅延を感じさせない
2. WHEN モーダルの開閉アニメーションが実行される THEN 記事詳細モーダル SHALL CSS `transition` または `animation` を使用し、60fps以上のフレームレートを維持する
3. IF モバイルデバイスのパフォーマンスが低い場合 THEN 記事詳細モーダル SHALL `will-change` プロパティや `transform: translateZ(0)` などのGPU加速を適切に使用し、スクロールやアニメーションのジャンクを最小化する
4. WHEN ブラウザがリフロー（reflow）を引き起こす可能性のあるスタイル変更を行う場合 THEN 実装 SHALL 可能な限り `transform` や `opacity` など、コンポジタースレッドで処理される CSS プロパティを使用する

---

## 技術制約

- **既存のHTMXベースのインタラクション**: モーダルの開閉ロジックはHTMX属性（`hx-get`, `hx-target`, `data-modal-close`など）を使用しているため、これらの動作を維持する
- **Tailwind CSSユーティリティクラス**: プロジェクトはTailwind CSSを使用しており、レスポンシブ対応は `md:`, `sm:` などのプレフィックスまたはカスタムメディアクエリで実装する
- **既存のグローバルCSSとの共存**: `app/static/css/style.css` には多数のグローバルスタイルが定義されているため、新規スタイルは既存スタイルと競合しないように注意する
- **Jinja2テンプレートエンジン**: モーダルのHTMLは `app/templates/partials/modal_content.html` で定義されており、サーバーサイドでレンダリングされる

## 非機能要件

- **ブラウザ互換性**: iOS Safari 14+, Chrome Mobile 90+, Firefox Mobile 90+ で正常に動作すること
- **パフォーマンス**: モバイルデバイス（iPhone 12, Pixel 5相当）でスクロールやアニメーションが60fps以上で動作すること
- **アクセシビリティ**: WCAG 2.1 Level AA の基準を満たし、スクリーンリーダーやキーボード操作で利用可能であること
- **保守性**: 追加するCSSやHTMLの変更は、他の開発者が理解しやすいようにコメントを付与し、命名規則に従うこと
